===============================================================================
               DOCUMENTACIÃ“N TÃ‰CNICA - 2DO PUNTO YAMAHA
===============================================================================

AUTOR: Technical Test Team
FECHA: 4 de Febrero de 2026
VERSIÃ“N: 1.0.0
DESCRIPCIÃ“N: Sistema completo para gestiÃ³n de ventas de motocicletas Yamaha

===============================================================================
                           ESTRUCTURA DEL 2DO PUNTO
===============================================================================

La carpeta "2do punto" contiene el sistema completo dividido en:

ğŸ“ 2do punto/
â”œâ”€â”€ ğŸ“ Frontend/           # AplicaciÃ³n React + TypeScript
â”œâ”€â”€ ğŸ“ backend/            # API REST Node.js + Express
â””â”€â”€ ğŸ“„ logicaProcesamientoBackPunto2.txt  # DocumentaciÃ³n de flujo

===============================================================================
                           FRONTEND - ARQUITECTURA
===============================================================================

ESTRUCTURA DE CARPETAS FRONTEND:
ğŸ“ Frontend/src/
â”œâ”€â”€ ğŸ“ components/        # Componentes React reutilizables
â”‚   â”œâ”€â”€ ğŸ“„ SalesForm.tsx     # Formulario de venta individual
â”‚   â””â”€â”€ ğŸ“„ FileUpload.tsx    # Carga masiva de archivos
â”œâ”€â”€ ğŸ“ services/          # Servicios de API
â”‚   â””â”€â”€ ğŸ“„ apiService.ts     # ComunicaciÃ³n con backend
â”œâ”€â”€ ğŸ“ schemas/           # ValidaciÃ³n con Zod
â”‚   â””â”€â”€ ğŸ“„ salesSchema.ts    # Schema de validaciÃ³n de ventas
â””â”€â”€ ğŸ“ types/             # Tipos TypeScript
    â””â”€â”€ ğŸ“„ index.ts          # Definiciones de interfaces

===============================================================================
                           COMPONENTES FRONTEND
===============================================================================

ğŸ“„ SALESFORM.TSX
----------------
PROPÃ“SITO: Formulario para registrar ventas individuales de motocicletas

FUNCIONALIDADES PRINCIPALES:
âœ… Formulario completo con validaciÃ³n en tiempo real
âœ… Manejo de estados (loading, error, success)
âœ… Notificaciones visuales modernas (no alerts)
âœ… ValidaciÃ³n con Zod y React Hook Form
âœ… ConexiÃ³n directa con backend via saveSale()

SECCIONES DEL FORMULARIO:
ğŸ”¹ DATOS DEL CLIENTE:
   - documento (cÃ©dula)
   - nombres
   - apellidos  
   - email

ğŸ”¹ DATOS DEL VEHÃCULO:
   - motor (nÃºmero de motor)
   - modelo_id (select con modelos Yamaha)

ğŸ”¹ DATOS DE LA TRANSACCIÃ“N:
   - factura_num
   - precio
   - fecha
   - ciudad
   - tienda
   - vendedor

DEPENDENCIAS:
- React Hook Form: Manejo del estado del formulario
- Zod: ValidaciÃ³n de datos
- apiService.ts: ComunicaciÃ³n con backend
- TailwindCSS: Estilos visuales

---

ğŸ“„ FILEUPLOAD.TSX
------------------
PROPÃ“SITO: Componente para carga masiva de ventas desde archivos CSV/TXT

FUNCIONALIDADES PRINCIPALES:
âœ… ValidaciÃ³n de archivos (solo CSV/TXT, mÃ¡ximo 10MB)
âœ… Indicador de progreso de subida en tiempo real
âœ… Manejo de errores y estados detallados
âœ… Feedback visual al usuario
âœ… ConexiÃ³n con backend via uploadSalesFile()

CARACTERÃSTICAS TÃ‰CNICAS:
ğŸ”¸ ValidaciÃ³n cliente-servidor
ğŸ”¸ XMLHttpRequest para progreso en tiempo real
ğŸ”¸ Auto-limpieza despuÃ©s de subida exitosa
ğŸ”¸ Drag & drop visual
ğŸ”¸ CancelaciÃ³n de subida

FLUJO DE ARCHIVO:
1. Usuario selecciona archivo CSV/TXT
2. ValidaciÃ³n de tipo y tamaÃ±o
3. Subida con indicador de progreso
4. Backend procesa lÃ­nea por lÃ­nea
5. Feedback con estadÃ­sticas

===============================================================================
                           SERVICIOS FRONTEND
===============================================================================

ğŸ“„ API_SERVICE.TS
-----------------
PROPÃ“SITO: Capa de abstracciÃ³n para comunicaciÃ³n con el backend

CONFIGURACIÃ“N:
ğŸ”¹ API_URL: http://localhost:3000/api/v1
ğŸ”¹ Timeout: 30 segundos para uploads
ğŸ”¹ Manejo centralizado de errores

MÃ‰TODOS PRINCIPALES:

1. saveSale(payload: SalesFormData)
   ğŸ“ Endpoint: POST /api/v1/ventas
   ğŸ¯ PropÃ³sito: Registrar venta individual
   ğŸ“¥ Retorna: ApiResponse<any>
   ğŸ”§ Usa: fetch() con headers JSON

2. uploadSalesFile(file: File, onProgress?: Function)
   ğŸ“ Endpoint: POST /api/v1/ventas/batch  
   ğŸ¯ PropÃ³sito: Subir archivo CSV/TXT para procesamiento masivo
   ğŸ“¥ Retorna: ApiResponse<any>
   ğŸ”§ Usa: XMLHttpRequest (soporta progreso)
   â±ï¸ Timeout: 30 segundos

TIPO DE RESPUESTA (ApiResponse):
```typescript
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  message?: string;
  errors?: string[];
}
```

===============================================================================
                           VALIDACIÃ“N FRONTEND
===============================================================================

ğŸ“„ SALES_SCHEMA.TS
------------------
PROPÃ“SITO: Definir reglas de validaciÃ³n con Zod (TypeScript-first)

CAMPOS REQUERIDOS (con validaciones):
âœ… documento: string (7-20 caracteres) - "CÃ©dula invÃ¡lida"
âœ… nombres: string (mÃ­nimo 2 caracteres) - "Nombre requerido"  
âœ… apellidos: string (mÃ­nimo 2 caracteres) - "Apellido requerido"
âœ… email: string (email vÃ¡lido) - "Email no vÃ¡lido"
âœ… motor: string (mÃ­nimo 5 caracteres) - "NÃºmero de motor requerido"
âœ… modelo_id: string (mÃ­nimo 1 caracter) - "Seleccione un modelo"
âœ… factura_num: string (mÃ­nimo 1 caracter) - "NÃºmero de factura requerido"
âœ… precio: number (positivo) - "El precio debe ser mayor a 0"
âœ… fecha: string (fecha vÃ¡lida) - "Fecha invÃ¡lida"
âœ… ciudad: string (mÃ­nimo 1 caracter) - "Ciudad requerida"
âœ… tienda: string (mÃ­nimo 1 caracter) - "Tienda requerida"
âœ… vendedor: string (mÃ­nimo 1 caracter) - "Vendedor requerido"

CAMPOS OPCIONALES:
ğŸ”¹ direccion, fecha_nacimiento, genero, celular
ğŸ”¹ cilindraje, color, fecha_ensamble, anio_modelo

===============================================================================
                           TIPOS DE DATOS
===============================================================================

ğŸ“„ TYPES/INDEX.TS
-----------------
PROPÃ“SITO: Definiciones TypeScript para todo el sistema

INTERFACES PRINCIPALES:

ğŸ”¹ Cliente
```typescript
interface Cliente {
  id?: number;
  documento: string;
  nombres: string;
  apellidos: string;
  direccion?: string;
  fecha_nacimiento?: string;
  genero?: string;
  celular: string;
  email: string;
}
```

ğŸ”¹ Vehiculo  
```typescript
interface Vehiculo {
  id?: number;
  modelo_id: number;
  motor: string;
  cilindraje: number;
  color: string;
  fecha_ensamble: string;
  anio_modelo: number;
}
```

ğŸ”¹ Venta
```typescript
interface Venta {
  id?: number;
  fecha: string;
  factura_num: string;
  ciudad: string;
  tienda: string;
  precio: number;
  cliente_id: number;
  vehiculo_id: number;
  vendedor: string;
}
```

===============================================================================
                           BACKEND - ARQUITECTURA
===============================================================================

ESTRUCTURA DE CARPETAS BACKEND:
ğŸ“ backend/src/
â”œâ”€â”€ ğŸ“ config/
â”‚   â””â”€â”€ ğŸ“„ database.js      # ConfiguraciÃ³n PostgreSQL
â”œâ”€â”€ ğŸ“ controllers/
â”‚   â””â”€â”€ ğŸ“„ ventasController.js  # LÃ³gica de negocio
â”œâ”€â”€ ğŸ“ middleware/
â”‚   â”œâ”€â”€ ğŸ“„ errorHandler.js      # Manejo de errores
â”‚   â”œâ”€â”€ ğŸ“„ upload.js            # ConfiguraciÃ³n Multer
â”‚   â””â”€â”€ ğŸ“„ validation.js        # ValidaciÃ³n Joi
â”œâ”€â”€ ğŸ“ routes/
â”‚   â””â”€â”€ ğŸ“„ ventas.js            # Rutas API
â”œâ”€â”€ ğŸ“„ index.js              # Servidor Express
â”œâ”€â”€ ğŸ“„ package.json          # Dependencias
â”œâ”€â”€ ğŸ“„ .env.example          # Variables de entorno
â””â”€â”€ ğŸ“„ README.md             # DocumentaciÃ³n

===============================================================================
                           CONFIGURACIÃ“N BASE DE DATOS
===============================================================================

ğŸ“„ DATABASE.JS
--------------
PROPÃ“SITO: GestiÃ³n de conexiÃ³n PostgreSQL y creaciÃ³n de esquema

CARACTERÃSTICAS:
ğŸ”¹ Pool de conexiones (mÃ¡ximo 20)
ğŸ”¹ CreaciÃ³n automÃ¡tica de tablas
ğŸ”¹ Transacciones ACID
ğŸ”¹ Datos por defecto (modelos de motocicletas)

TABLAS CREADAS AUTOMÃTICAMENTE:

ğŸ“‹ clientes
- id (SERIAL PRIMARY KEY)
- documento (VARCHAR(20) UNIQUE)
- nombres, apellidos, email, direccion
- fecha_nacimiento, genero, celular
- created_at, updated_at

ğŸ“‹ modelos  
- id (SERIAL PRIMARY KEY)
- nombre, categoria
- created_at

ğŸ“‹ vehiculos
- id (SERIAL PRIMARY KEY)  
- modelo_id (FK a modelos)
- motor, cilindraje, color
- fecha_ensamble, anio_modelo
- created_at

ğŸ“‹ ventas
- id (SERIAL PRIMARY KEY)
- fecha, factura_num (UNIQUE)
- ciudad, tienda, precio
- cliente_id (FK a clientes)
- vehiculo_id (FK a vehiculos)  
- vendedor, created_at

DATOS POR DEFECTO (modelos):
1. MT-07 (Naked)
2. YZF-R3 (Sport)  
3. TÃ©nÃ©rÃ© 700 (Adventure)
4. NMAX (Scooter)

===============================================================================
                           LÃ“GICA DE NEGOCIO
===============================================================================

ğŸ“„ VENTASCONTROLLER.JS
---------------------
PROPÃ“SITO: Controlador principal para operaciones de ventas

MÃ‰TODOS:

1. createSale(req, res)
   ğŸ¯ CREAR VENTA INDIVIDUAL
   ğŸ“‹ Flujo:
   a) Validar datos de entrada
   b) Iniciar transacciÃ³n PostgreSQL
   c) Buscar cliente por documento
      - Si no existe: crear nuevo cliente
      - Si existe: usar cliente existente
   d) Crear vehÃ­culo con datos proporcionados
   e) Crear venta relacionando cliente y vehÃ­culo
   f) Hacer COMMIT de transacciÃ³n
   g) Retornar respuesta con IDs generados

2. processSalesFile(req, res)  
   ğŸ¯ PROCESAMIENTO MASIVO DESDE ARCHIVO
   ğŸ“‹ Flujo:
   a) Validar archivo subido (Multer)
   b) Procesar CSV lÃ­nea por lÃ­nea con csv-parser
   c) Para cada lÃ­nea:
      - Validar campos requeridos
      - Buscar/crear cliente (como en createSale)
      - Crear vehÃ­culo
      - Crear venta
      - Contabilizar Ã©xito/error
   d) Limpiar archivo temporal
   e) Retornar estadÃ­sticas completas

CARACTERÃSTICAS TÃ‰CNICAS:
ğŸ”¸ Transacciones atÃ³micas (consistencia garantizada)
ğŸ”¸ Manejo robusto de errores por registro
ğŸ”¸ Procesamiento asÃ­ncrono no bloqueante
ğŸ”¸ ValidaciÃ³n completa de datos

===============================================================================
                           MIDDLEWARE BACKEND
===============================================================================

ğŸ“„ ERRORHANDLER.JS
------------------
PROPÃ“SITO: Manejo centralizado de errores del servidor

TIPOS DE ERRORES MANEJADOS:
âš ï¸ Errores de validaciÃ³n (Joi)
âš ï¸ Errores de Multer (upload de archivos)
âš ï¸ Errores de PostgreSQL (23505=duplicado, 23503=FK)
âš ï¸ Errores genÃ©ricos del servidor

RESPUESTA ESTÃNDAR:
```javascript
{
  success: false,
  message: "Mensaje de error descriptivo",
  errors: ["array de errores si aplica"] // solo en desarrollo
}
```

---

ğŸ“„ UPLOAD.JS  
-----------
PROPÃ“SITO: ConfiguraciÃ³n de Multer para subida de archivos

CARACTERÃSTICAS:
ğŸ”¸ Almacenamiento en disco con nombres Ãºnicos (timestamp_nombre)
ğŸ”¸ ValidaciÃ³n de tipo: solo CSV/TXT
ğŸ”¸ LÃ­mite de tamaÃ±o: 10MB (configurable via MAX_FILE_SIZE)
ğŸ”¸ CreaciÃ³n automÃ¡tica de directorio uploads/
ğŸ”¸ SanitizaciÃ³n de nombres de archivo

CONFIGURACIÃ“N:
```javascript
const storage = multer.diskStorage({
  destination: './uploads',
  filename: (req, file, cb) => {
    const timestamp = Date.now();
    const cleanName = file.originalname.replace(/[^a-zA-Z0-9.-]/g, '_');
    cb(null, `${timestamp}_${cleanName}`);
  }
});
```

---

ğŸ“„ VALIDATION.JS
---------------
PROPÃ“SITO: ValidaciÃ³n de datos de entrada con Joi

SCHEMA COMPLETO:
- Todos los campos del formulario de ventas
- Validaciones de tipo, formato, longitud
- Mensajes de error personalizados en espaÃ±ol

EJEMPLO DE VALIDACIÃ“N:
```javascript
documento: Joi.string().min(7).max(20)
  .required().messages({
    'string.min': 'CÃ©dula debe tener al menos 7 caracteres',
    'any.required': 'CÃ©dula es requerida'
  })
```

===============================================================================
                           RUTAS API REST
===============================================================================

ğŸ“„ VENTAS.JS
-----------
PROPÃ“SITO: DefiniciÃ³n de endpoints REST para ventas

ENDPOINTS DISPONIBLES:

ğŸ”¹ POST /api/v1/ventas
   ğŸ“¯ PropÃ³sito: Crear venta individual
   ğŸ”§ Middleware: validateSale (Joi)
   ğŸ® Controller: createSale
   ğŸ“¦ Body: JSON con datos completos de venta
   âœ… Response: {success: true, data: {venta_id, cliente_id, vehiculo_id}}

ğŸ”¹ POST /api/v1/ventas/batch  
   ğŸ“¯ PropÃ³sito: Procesamiento masivo desde archivo
   ğŸ”§ Middleware: upload.single('file') (Multer)
   ğŸ® Controller: processSalesFile
   ğŸ“¦ Content-Type: multipart/form-data
   âœ… Response: {success: true, data: {processed, errors, total, details}}

ğŸ”¹ GET /health
   ğŸ“¯ PropÃ³sito: Health check del servidor
   âœ… Response: {status: 'OK', timestamp, uptime}

===============================================================================
                           FLUJOS DE DATOS COMPLETOS
===============================================================================

ğŸ”„ ESCENARIO 1: VENTA INDIVIDUAL
--------------------------------
1. ğŸ–±ï¸ Usuario completa SalesForm.tsx
2. âœ… React Hook Form valida con Zod schema (tiempo real)
3. ğŸ“¤ Usuario hace submit â†’ onSubmit()
4. ğŸŒ saveSale() hace POST a /api/v1/ventas
5. ğŸ” Backend: validateSale middleware (Joi)
6. ğŸ’¾ Backend: createSale controller
7. ğŸ—„ï¸ TransacciÃ³n PostgreSQL:
   - ğŸ” Busca cliente por documento
   - ğŸ‘¤ Si no existe â†’ crea cliente
   - ğŸï¸ Crea vehÃ­culo
   - ğŸ’° Crea venta
8. âœ… COMMIT transacciÃ³n
9. ğŸ“¬ Respuesta JSON con Ã©xito/error
10. ğŸ‰ Frontend muestra notificaciÃ³n verde/roja

ğŸ”„ ESCENARIO 2: CARGA MASIVA  
-----------------------------
1. ğŸ“ Usuario selecciona archivo CSV/TXT en FileUpload.tsx
2. ğŸ” ValidaciÃ³n cliente (tipo, tamaÃ±o, extensiÃ³n)
3. ğŸ“¤ uploadSalesFile() con callback de progreso
4. ğŸŒ XMLHttpRequest POST a /api/v1/ventas/batch
5. ğŸ“‚ Multer guarda archivo temporalmente en ./uploads/
6. ğŸ“„ processSalesFile controller:
   - ğŸ“– csv-parser procesa lÃ­nea por lÃ­nea
   - ğŸ” Por cada lÃ­nea: valida campos requeridos
   - ğŸ‘¤ Busca/crea cliente (como en venta individual)
   - ğŸï¸ Crea vehÃ­culo
   - ğŸ’° Crea venta  
   - ğŸ“Š Contabiliza Ã©xitos y errores
7. ğŸ—‘ï¸ Limpia archivo temporal
8. ğŸ“¬ Respuesta con estadÃ­sticas completas
9. ğŸ‰ Frontend muestra resumen de procesamiento

===============================================================================
                           CONFIGURACIÃ“N Y DESPLIEGUE
===============================================================================

ğŸ“„ PACKAGE.JSON (BACKEND)
-------------------------
DEPENDENCIAS PRINCIPALES:
ğŸ”¹ express: Framework web
ğŸ”¹ pg: Driver PostgreSQL  
ğŸ”¹ multer: Subida de archivos
ğŸ”¹ joi: ValidaciÃ³n de datos
ğŸ”¹ csv-parser: Procesamiento CSV
ğŸ”¹ cors: Compartir recursos entre orÃ­genes
ğŸ”¹ helmet: Seguridad HTTP
ğŸ”¹ morgan: Logging de peticiones

SCRIPTS:
ğŸƒâ€â™‚ï¸ npm start â†’ ProducciÃ³n
ğŸ”§ npm run dev â†’ Desarrollo con nodemon
ğŸ§ª npm test â†’ Pruebas

ğŸ“„ .ENV.EXAMPLE
--------------
VARIABLES DE ENTORNO:
```env
# Servidor
PORT=3000
NODE_ENV=development
FRONTEND_URL=http://localhost:5173

# Base de datos  
DB_HOST=localhost
DB_PORT=5432
DB_NAME=yamaha_test
DB_USER=postgres
DB_PASSWORD=password

# Archivos
MAX_FILE_SIZE=10485760
UPLOAD_PATH=./uploads
```

===============================================================================
                           RELACIÃ“N ENTRE ARCHIVOS
===============================================================================

ğŸ”— FRONTEND INTERNO:
SalesForm.tsx â†” apiService.ts â†” salesSchema.ts â†” types/index.ts
     â†“              â†“              â†“              â†“
   Formulario â†’ API Calls â†’ ValidaciÃ³n â†’ Tipos de datos

ğŸ”— BACKEND INTERNO:  
index.js â†’ routes/ventas.js â†’ middleware/ â†’ controllers/ventasController.js â†’ config/database.js
    â†“           â†“              â†“              â†“                    â†“
  Servidor â†’ Rutas â†’ ValidaciÃ³n/Upload â†’ LÃ³gica negocio â†’ Base datos

ğŸ”— COMUNICACIÃ“N FRONTEND-BACKEND:
Frontend (apiService.ts) â†” HTTP Request â†” Backend (Express)
    â†“                           â†“
  http://localhost:3000/api/v1/ventas  â†’  ventasController.js
  http://localhost:3000/api/v1/ventas/batch â†’ processSalesFile()

===============================================================================
                           RESUMEN FUNCIONAL
===============================================================================

ğŸ¯ OBJETIVO PRINCIPAL: Sistema completo para gestiÃ³n de ventas Yamaha

âœ… CARACTERÃSTICAS IMPLEMENTADAS:
- Formulario de venta individual con validaciÃ³n completa
- Carga masiva desde archivos CSV/TXT  
- Base de datos PostgreSQL con relaciones completas
- API REST robusta con manejo de errores
- Interfaz moderna con feedback visual
- Procesamiento asÃ­ncrono y escalable
- ValidaciÃ³n cliente-servidor
- Manejo de transacciones ACID

ğŸ”§ TECNOLOGÃAS UTILIZADAS:
- Frontend: React, TypeScript, TailwindCSS, React Hook Form, Zod
- Backend: Node.js, Express, PostgreSQL, Multer, Joi
- ComunicaciÃ³n: REST APIs, XMLHttpRequest, JSON

ğŸ“Š FLUJO DE INFORMACIÃ“N:
Usuario â†’ Frontend â†’ API REST â†’ Backend â†’ PostgreSQL â†’ Respuesta â†’ Frontend â†’ Usuario

===============================================================================
                           FIN DE DOCUMENTACIÃ“N
===============================================================================

Este documento cubre completamente la arquitectura, funcionamiento y relaciÃ³n
entre todos los archivos del 2do punto del proyecto Yamaha Technical Test.

Para mÃ¡s informaciÃ³n tÃ©cnica detallada, consultar:
- README.md del backend (instrucciones de instalaciÃ³n)
- logicaProcesamientoBackPunto2.txt (flujo original)
- CÃ³digo fuente comentado en cada archivo
